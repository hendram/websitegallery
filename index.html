<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Design Gallery</title>

<style>
body{
  margin:0;
  font-family:sans-serif;
  background:#0f1115;
  color:white;
}
h1{padding:20px;margin:0}
#controls{
  padding:0 20px 20px;
  display:flex;
  gap:10px;
}
select,input{
  padding:10px;
  border-radius:10px;
  border:none;
  background:#1a1d23;
  color:white;
}
input{flex:1}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
  gap:20px;
  padding:20px;
}

.card{
  background:#1a1d23;
  border-radius:14px;
  overflow:hidden;
  cursor:pointer;
  box-shadow:0 10px 25px rgba(0,0,0,.4);
  transition:.25s;
}
.card:hover{
  transform:translateY(-5px) scale(1.02);
}
.card img{
  width:100%;
  display:block;
}
.label{
  padding:10px;
  font-size:13px;
  opacity:.7;
}
.empty{
  padding:40px;
  text-align:center;
  opacity:.5;
}

/* viewer */
.viewer{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.9);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
}
.viewer img{
  max-width:90%;
  max-height:90%;
  border-radius:12px;
  box-shadow:0 0 40px black;
  animation:zoom .25s ease;
}
@keyframes zoom{
  from{transform:scale(.8);opacity:.3}
  to{transform:scale(1);opacity:1}
}
</style>
</head>
<body>

<h1>UI Design Collection</h1>

<div id="controls">
<select id="folderSelect"></select>
<input id="search" placeholder="Search images...">
</div>

<div id="gallery" class="grid"></div>

<div id="viewer" class="viewer">
<img id="viewerImg">
</div>

<script>
const user="hendram";
const repo="websitegallery";

const gallery=document.getElementById("gallery");
const viewer=document.getElementById("viewer");
const viewerImg=document.getElementById("viewerImg");
const search=document.getElementById("search");

let currentImages=[];
let currentIndex=0;

/* ---------- utils ---------- */

async function fetchJSON(url){
  const r=await fetch(url);
  if(!r.ok) throw new Error(await r.text());
  return await r.json();
}

function message(t){
  gallery.innerHTML=`<div class="empty">${t}</div>`;
}

function enc(path){
  return path.split("/").map(encodeURIComponent).join("/");
}

/* ---------- dynamic select builder ---------- */

const controls=document.getElementById("controls");
controls.innerHTML="";

function createSelect(level){
  const s=document.createElement("select");
  s.dataset.level=level;
  controls.appendChild(s);
  return s;
}

const s1=createSelect(1);
const s2=createSelect(2);
const s3=createSelect(3);
controls.appendChild(search);

/* ---------- load directories ---------- */

async function getDirs(path=""){
  const url=`https://api.github.com/repos/${user}/${repo}/contents/${enc(path)}`;
  const items=await fetchJSON(url);
  return items.filter(i=>i.type==="dir");
}

async function fillSelect(select,path){
  select.innerHTML="<option value=''>-- choose --</option>";
  const dirs=await getDirs(path);

  dirs.forEach(d=>{
    const o=document.createElement("option");
    o.value=d.path;
    o.textContent=d.name;
    select.appendChild(o);
  });
}

/* ---------- cascade logic ---------- */

s1.onchange=async()=>{
  gallery.innerHTML="";
  s2.innerHTML="";
  s3.innerHTML="";
  if(!s1.value) return;
  await fillSelect(s2,s1.value);
};

s2.onchange=async()=>{
  gallery.innerHTML="";
  s3.innerHTML="";
  if(!s2.value) return;
  await fillSelect(s3,s2.value);
};

s3.onchange=async()=>{
  if(!s3.value) return;
  await loadImagesRecursive(s3.value);
};

/* ---------- recursive image loader ---------- */

async function loadImagesRecursive(path){
  message("Loading images...");
  currentImages=[];

  async function scan(p){
    const items=await fetchJSON(
      `https://api.github.com/repos/${user}/${repo}/contents/${enc(p)}`
    );

    for(const item of items){
      if(item.type==="dir"){
        await scan(item.path);
      }else if(item.name.match(/\.(png|jpg|jpeg|webp|gif)$/i)){
        currentImages.push(item);
      }
    }
  }

  try{
    await scan(path);
    render();
  }catch(e){
    console.error(e);
    message("Failed loading folder");
  }
}

/* ---------- render ---------- */

function render(){
  const term=search.value.toLowerCase();
  gallery.innerHTML="";

  const filtered=currentImages.filter(i=>
    i.name.toLowerCase().includes(term)
  );

  if(!filtered.length){
    message("No images match search");
    return;
  }

  filtered.forEach((file,i)=>{
    const card=document.createElement("div");
    card.className="card";

    card.innerHTML=`
      <img src="${file.download_url}">
      <div class="label">${file.name}</div>
    `;

    card.onclick=()=>{
      currentIndex=i;
      showViewer();
    };

    gallery.appendChild(card);
  });
}

/* ---------- viewer ---------- */

function showViewer(){
  viewerImg.src=currentImages[currentIndex].download_url;
  viewer.style.display="flex";
}

function next(){
  currentIndex=(currentIndex+1)%currentImages.length;
  showViewer();
}

function prev(){
  currentIndex=(currentIndex-1+currentImages.length)%currentImages.length;
  showViewer();
}

/* ---------- events ---------- */

search.oninput=render;

viewer.onclick=e=>{
  if(e.target===viewer) viewer.style.display="none";
};

document.addEventListener("keydown",e=>{
  if(viewer.style.display!=="flex") return;

  if(e.key==="Escape") viewer.style.display="none";
  if(e.key==="ArrowRight") next();
  if(e.key==="ArrowLeft") prev();
});

/* ---------- start ---------- */

fillSelect(s1);
</script>

</body>
</html>
